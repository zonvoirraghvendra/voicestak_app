!function(){"use strict";var t={init:function(){this.options?(this.pos=0,this.cam=null,this.filter_on=!1,this.filter_id=0,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.ctx.clearRect(0,0,this.options.width,this.options.height),this.image=this.ctx.getImageData(0,0,this.options.width,this.options.height),this.snapshotBtn=document.getElementById("takeSnapshot"),this.detectBtn=document.getElementById("detectFaces"),getUserMedia(this.options,this.success,this.deviceError),window.webcam=this.options,this.addEvent("click",this.snapshotBtn,this.getSnapshot),this.addEvent("click",this.detectBtn,function(){t.drawToCanvas("glasses")})):alert("No options were supplied to the shim!")},addEvent:function(t,e,a){e.attachEvent?(e["e"+t+a]=a,e[t+a]=function(){e["e"+t+a](window.event)},e.attachEvent("on"+t,e[t+a])):e.addEventListener(t,a,!1)},options:{audio:!1,video:!0,el:"webcam",extern:null,append:!0,width:320,height:240,mode:"callback",swffile:"../dist/fallback/jscam_canvas_only.swf",quality:85,context:"",debug:function(){},onCapture:function(){window.webcam.save()},onTick:function(){},onSave:function(e){for(var a=e.split(";"),i=t.image,n=null,o=this.width,s=this.height,c=0;o>c;c++)n=parseInt(a[c],10),i.data[t.pos+0]=n>>16&255,i.data[t.pos+1]=n>>8&255,i.data[t.pos+2]=255&n,i.data[t.pos+3]=255,t.pos+=4;t.pos>=4*o*s&&(t.ctx.putImageData(i,0,0),t.pos=0)},onLoad:function(){}},success:function(e){if("webrtc"===t.options.context){var a=t.options.videoEl;if("undefined"!=typeof MediaStream&&null!==MediaStream&&e instanceof MediaStream)return void 0!==a.mozSrcObject?a.mozSrcObject=e:a.src=e,a.play();var i=window.URL||window.webkitURL;a.src=i?i.createObjectURL(e):e,a.onerror=function(){e.stop(),streamError()}}},deviceError:function(t){alert("No camera available."),console.error("An error occurred: [CODE "+t.code+"]")},changeFilter:function(){this.filter_on&&(this.filter_id=this.filter_id+1&7)},getSnapshot:function(){if("webrtc"===t.options.context){var e=document.getElementsByTagName("video")[0];t.canvas.width=e.videoWidth,t.canvas.height=e.videoHeight,t.canvas.getContext("2d").drawImage(e,0,0)}else"flash"===t.options.context?(window.webcam.capture(),t.changeFilter()):alert("No context was supplied to getSnapshot()")},drawToCanvas:function(t){var e,a,i,n,o,s;if(e=document.querySelector("#canvas"),a=new Image,a.src="js/glasses/i/glasses.png",i=document.querySelector("#output"),n=i.getContext("2d"),n.drawImage(e,0,0,520,426),o=n.getImageData(0,0,i.width,i.height),"hipster"===t){for(s=0;s<o.data.length;s+=4)o.data[s+0]=3*o.data[s+0],o.data[s+1]=2*o.data[s+1],o.data[s+2]=o.data[s+2]-10;n.putImageData(o,0,0)}else if("greenscreen"===t){var c=$("#red input.min").val(),d=$("#green input.min").val(),r=$("#blue input.min").val(),h=$("#red input.max").val(),l=$("#green input.max").val(),u=$("#blue input.max").val(),p=0,g=0,m=0;for(s=0;s<o.data.length;s+=4)g=o.data[s+0],p=o.data[s+1],m=o.data[s+2],alpha=o.data[s+3],g>=c&&p>=d&&m>=r&&h>=g&&l>=p&&u>=m&&(o.data[s+3]=0);n.putImageData(o,0,0)}else if("glasses"===t){var v=ccv.detect_objects({canvas:i,cascade:cascade,interval:5,min_neighbors:1});for(s=0;s<v.length;s++)n.drawImage(a,v[s].x,v[s].y,v[s].width,v[s].height)}}};t.init()}();