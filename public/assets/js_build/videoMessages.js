$(document).ready(function(){function e(e){if(0==e.getVideoTracks().length)return alert("Error Capturing Video!!! Please check is camera connected or Have You a permission to use it!!!"),!1;l=document.querySelector("video"),window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,l.src=window.URL.createObjectURL(e),i=e;var t={leftChannel:!0};u?d=RecordRTC(e,t):(a=new MultiStreamRecorder(e),a.video=l,a.ondataavailable=function(e){c=e.audio,s=e.video,p&&n(),p=!0}),$("#popup9 #capture").show(),$("#popup15 #capture").show(),$("#popup27 #capture").show()}function t(e){alert("Error Capturing Video!!! Please check is camera connected or Have You a permission to use it!!!")}function o(){g++,10==g&&(g=0,m++),6==m&&(m=0,v++),y=v+":"+m+g,document.getElementById("record_length").innerHTML=y}function n(){p=!1,"true"===$(".check_domain").val()&&($(".display_div").hide(),$(".display_div:nth-child(10)").show()),u?d.stopRecording(function(e){s=d.getBlob()}):a.stop(),h.stop(),document.getElementById("video-pause").style.display="none",document.getElementById("video-stop").style.display="none",document.getElementById("capture").style.display="inline-block";var e=new XMLHttpRequest,t=new FormData;u?($("#videospanimg").css("display","inline-block"),setTimeout(function(){t.append("videofile",s),console.log(s),t.append("length",y),e.open("POST","/messages/upload-file",!0),e.send(t)},3e3)):($("#videospanimg").css("display","inline-block"),setTimeout(function(){t.append("audiofile",c),t.append("videofile",s),t.append("length",y),e.open("POST","/messages/upload-file",!0),e.send(t)},3e3)),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&($("#videospanimg").css("display","none"),$(".btn-holder").show(),localStorage.message_length=y,localStorage.fileName=JSON.parse(e.responseText).file_name,localStorage.file=r+JSON.parse(e.responseText).file_name,localStorage.id=JSON.parse(e.responseText).id,$("#video_watch").prop("src",localStorage.file),document.getElementById("message_length").innerHTML=localStorage.message_length,document.getElementById("video_file_name").value=localStorage.fileName,document.getElementById("video_duration").value=localStorage.message_length,document.getElementById("video_token").value=localStorage.token,m=0,g=0,v=0,y="0:00")}}var a,i,d,l,r="/uploads/video/",s=1,c=1,p=!0,u=!!navigator.mozGetUserMedia;$("#popup7 .btn-popup,#popup13 .btn-popup,#popup25 .start-video").click(function(){if("true"===$(".check_domain").val()){$("#popup9 #capture").hide(),$("#popup15 #capture").hide(),$("#popup27 #capture").hide();var o={audio:!0,video:!0};navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),navigator.getUserMedia(o,e,t)}});var m=0,g=0,v=0,y="0:00";if(0!==$("#record_length").length&&(document.getElementById("record_length").innerHTML=y),"undefined"!=typeof $.timer){var h=$.timer(o,1e3,!0);h.stop()}$("#capture").on("click",function(){"true"===$(".check_domain").val()&&(document.getElementById("capture").style.display="none",document.getElementById("video-stop").style.display="inline-block",u?(d.startRecording(),0==$(".is_premium").val()?(p&&setTimeout(n,3e5),p=!0):(p&&setTimeout(n,6e5),p=!0)):0==$(".is_premium").val()?a.start(3e5):a.start(6e5),h.play())}),$("#video-stop").on("click",function(){"true"===$(".check_domain").val()&&n()}),$("#play_back").on("click",function(){if("true"===$(".check_domain").val()){var e=document.getElementById("video_watch");e.play()}})});