$(document).ready(function(){function e(){w++,10==w&&(w=0,v++),6==v&&(v=0,U++),_=U+":"+v+w,document.getElementById("record_length").innerHTML=_}function t(){function e(e,t){return e.name=t,e}f=!1,"true"===$(".check_domain").val()&&($(".display_div").hide(),$(".display_div:nth-child(5)").show()),S.stop(),document.getElementById("play").style.display="inline-block",p=!1;var t=a(l,d),i=a(r,d),s=n(t,i),u=new ArrayBuffer(44+2*s.length),c=new DataView(u);o(c,0,"RIFF"),c.setUint32(4,44+2*s.length,!0),o(c,8,"WAVE"),o(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,2,!0),c.setUint32(24,g,!0),c.setUint32(28,4*g,!0),c.setUint16(32,4,!0),c.setUint16(34,16,!0),o(c,36,"data"),c.setUint32(40,2*s.length,!0);for(var m=s.length,h=44,M=1,k=0;m>k;k++)c.setInt16(h,s[k]*(32767*M),!0),h+=2;var B=new Blob([c],{type:"audio/wav"}),E=(e(B,"message.wav"),new XMLHttpRequest),I=new FormData;I.append("file",B),I.append("length",_),E.open("POST","/messages/upload-file",!0),$("#spanimg").css("display","inline-block"),E.onreadystatechange=function(){4==E.readyState&&(200!=E.status?alert("Error Was Occured."):($("#spanimg").css("display","none"),$(".hidden_div").show(),localStorage.message_length=_,localStorage.fileName=JSON.parse(E.responseText).file_name,localStorage.id=JSON.parse(E.responseText).id,localStorage.file=y+JSON.parse(E.responseText).file_name,$("#music").prop("src",localStorage.file),document.getElementById("message_length").innerHTML=localStorage.message_length,document.getElementById("file_name").value=localStorage.fileName,document.getElementById("duration").value=localStorage.message_length,document.getElementById("token").value=localStorage.token,v=0,w=0,U=0,_="0:00",l.length=r.length=0,d=0))},E.send(I)}function n(e,t){for(var n=e.length+t.length,a=new Float32Array(n),o=0,i=0;n>i;)a[i++]=e[o],a[i++]=t[o],o++;return a}function a(e,t){for(var n=new Float32Array(t),a=0,o=e.length,i=0;o>i;i++){var l=e[i];n.set(l,a),a+=l.length}return n}function o(e,t,n){for(var a=n.length,o=0;a>o;o++)e.setUint8(t+o,n.charCodeAt(o))}function i(e){m=window.AudioContext||window.webkitAudioContext,h=new m,g=h.sampleRate,u=h.createGain(),c=h.createMediaStreamSource(e),c.connect(u);var t=2048;s=h.createScriptProcessor(t,2,2),s.onaudioprocess=function(e){if(p){var n=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1);l.push(new Float32Array(n)),r.push(new Float32Array(a)),d+=t}},u.connect(s),s.connect(h.destination),$("#popup20 #play").show(),$("#popup4 #play").show(),$("#popup32 #play").show()}var l=[],r=[],s=null,p=!1,d=0,u=null,c=null,g=null,m=null,h=null,y=(document.getElementById("output"),"/uploads/audio/"),f=(!!navigator.mozGetUserMedia,!0);$("#popup18 .btn-popup,#popup2 .btn-popup,#popup30 .start-video").click(function(){"true"===$(".check_domain").val()&&($("#popup20 #play").hide(),$("#popup4 #play").hide(),$("#popup32 #play").hide(),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),navigator.getUserMedia?navigator.getUserMedia({audio:!0},i,function(e){alert("Error capturing audio.")}):alert("getUserMedia not supported in this browser."))});var v=0,w=0,U=0,_="0:00";if(0!==$("#record_length").length&&(document.getElementById("record_length").innerHTML=_),"undefined"!=typeof $.timer){var S=$.timer(e,1e3,!0);S.stop()}$(".play").on("click",function(){"true"===$(".check_domain").val()&&(document.getElementById("play").style.display="none",document.getElementById("stop").style.display="inline-block",S.play(),p=!0,0==$(".is_premium").val()?(f&&setTimeout(t,3e5),f=!0):(f&&setTimeout(t,6e5),f=!0))}),$(".stop").on("click",function(){"true"===$(".check_domain").val()&&t()})});